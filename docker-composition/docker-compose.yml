version: '3'
services:
  # api-gateway:
  #   build: ./services/apiGateway
  #   ports:
  #     - "5000:8080"

  # order:
  #   build: ./services/order
  #   ports:
  #     - "6001:8080"
  #   depends_on:
  #     - "mongo"
  #   restart: "on-failure"

  # inventory:
  #   build:
  #     context: ..
  #     dockerfile: ./services/inventory/Dockerfile
  #   ports:
  #     - "6002:8080"
  #   restart: "on-failure"

  mongodb-primary:
    image: 'bitnami/mongodb:latest'
    environment:
      - MONGODB_REPLICA_SET_MODE=primary
    volumes:
      - 'mongodb_master_data:/bitnami'
    ports:
      - "27017:27017"

  mongodb-secondary:
    image: 'bitnami/mongodb:latest'
    depends_on:
      - mongodb-primary
    environment:
      - MONGODB_REPLICA_SET_MODE=secondary
      - MONGODB_PRIMARY_HOST=mongodb-primary
      - MONGODB_PRIMARY_PORT_NUMBER=27017
    ports:
      - "27018:27017"

  mongodb-arbiter:
    image: 'bitnami/mongodb:latest'
    depends_on:
      - mongodb-primary
    environment:
      - MONGODB_REPLICA_SET_MODE=arbiter
      - MONGODB_PRIMARY_HOST=mongodb-primary
      - MONGODB_PRIMARY_PORT_NUMBER=27017
    ports:
      - "27019:27017"

volumes:
  mongodb_master_data:
    driver: local